schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}

type Query @aws_iam {
  region: String!
}

type Mutation @aws_iam {
  publishHealth(id: ID!): HealthNotification
  publishMatch(queue: String!, sessionId: ID!, players: [PlayerInput!]!): QueueNotification
}

type Subscription @aws_iam @aws_lambda {
  healthcheck(id: ID!): HealthNotification @aws_iam @aws_subscribe(mutations: ["publishHealth"])
  joinUnrankedSoloQueue(config: PlayerConfigInput!): QueueNotification @aws_subscribe(mutations: ["publishMatch"])
}

type HealthNotification @aws_iam @aws_lambda {
  id: ID!
}

union QueueNotification @aws_iam @aws_lambda = Match | Heartbeat

type Heartbeat @aws_iam @aws_lambda {
  timestamp: String!
}

type Match @aws_iam @aws_lambda {
  sessionId: ID!
  queue: String!
  playerIds: [String!]!
  players: [Player!]!
}

type Player @aws_iam @aws_lambda {
  userId: String!
  info: PlayerInfo!
  ip: AWSIPAddress!
  # todo: get config in here
}

type PlayerInfo @aws_iam @aws_lambda {
  name: String!
}

input PlayerInput {
  userId: String!
  info: PlayerInfoInput!
  ip: AWSIPAddress!
}

input PlayerInfoInput {
  name: String!
}

input PlayerConfigInput {
  forceLanIp: String
}
